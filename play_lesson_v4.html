<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset ='UTF-8'>
  <meta name = "viewport" content = "width=device-width", initial-scale = 1.0">
  <title>Vocals Lessons Simplified (VLS)</title>
  <link rel="stylesheet" href="styles.css">
</head>


<body>
  <div class="header">
    <h1>Vocal Lessons Simplified</h1>
  </div>
  <div class = "para">
    <p> 1) Choose a lesson from drop down 2) select vocal range and 3) Press "Play" </p>
  </div>



  <label for="lessons">Choose your lesson:</label>

  <div class="select">
  <select id="lesson_select" name ="lesson_select">
    <!option value="rocket">Rocket's red glare</option>
    <option value="step51">Fifths_slow</option>
    <!option value="octave1">Octave 1</option>
    <option value="step52">Fifths_fast</option>
    <option value="step53">octave</option>
  </select>
  </div>

  <label for="lessons">Choose your vocal range:</label>

    <div class="select">
      <select id = "vocal_range" name = "vocal_range">
        <option value="male">male - tenor, barritone, bass</option>
        <option value="female">female - soprano, mezzo soprano, alto</option>
      </select>
    </div>
   
  <button type="button" class="click">Play Lesson</button>
  <button_stop type="button" class="click">Stop Lesson</button_stop>

  <div class = "down_note">
    <p>Any feedback? Message me <a href="https://www.facebook.com/profile.php?id=61556343535866" target="_blank">here!</a></p>
    </div>

</body>
  <script>
       // ise following scipt to pop up a message when page reloads
   // var firstPara = document.querySelector('p');
   // firstPara.className = 'blue';
   // const paragraphs = document.querySelectorAll("p");
    // paragraphs[0] is the first <p> element
    // paragraphs[1] is the second <p> element, etc.
    //alert(paragraphs[0].nodeName);

    //var context = new AudioContext();
    try {
      window.AudioContext = window.AudioContext || window.webkitAudioContext;
      ctx = new AudioContext();
      //console.log(gainNode)
    }
    catch(e) {
      alert('Web Audio API is not supported in this browser');
    }

    var btn = document.querySelector('button');
    var btn_stop = document.querySelector('button_stop');
    const gainNode = ctx.createGain();
    //document.querySelector("button").disabled = true;
    

      // run this command to start the server python simple-cors-http-server.py


//audiobuffer is short audio asset residing in memory

    fetch("https://vocallesson.s3.us-west-2.amazonaws.com/C4v9.wav")
    //https://vocallesson.s3.us-west-2.amazonaws.com/C4v9.wav
      .then(data => data.arrayBuffer())
    	.then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
    	.then(decodedAudio => {
    	c4 = decodedAudio;
    	})

    fetch("https://vocallesson.s3.us-west-2.amazonaws.com/C5v9.wav")
    //https://vocallesson.s3.us-west-2.amazonaws.com/C5v9.wav
      .then(data => data.arrayBuffer())
      .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
      .then(decodedAudio => {
     	 c5 = decodedAudio;
      })

    fetch("https://vocallesson.s3.us-west-2.amazonaws.com/C3v9.wav")
    //https://vocallesson.s3.us-west-2.amazonaws.com/C3v9.wav
      .then(data => data.arrayBuffer())
      .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
      .then(decodedAudio => {
       c3 = decodedAudio;
      })

    fetch("https://vocallesson.s3.us-west-2.amazonaws.com/C2v9.wav")
    //https://vocallesson.s3.us-west-2.amazonaws.com/C2v9.wav
      .then(data => data.arrayBuffer())
      .then(arrayBuffer => ctx.decodeAudioData(arrayBuffer))
      .then(decodedAudio => {
       c2 = decodedAudio;
      })


    var playSound = new Array()
    var counter;
    var counter = 0; 
    function playnote(note, delay) {
      playSound[counter] = ctx.createBufferSource();
      detune = 0;
      if (note === 'c5') {
        detune = 0;
        nt = c5;
      } else if (note === 'cs5') {
        detune = 100;
        nt = c5;
      } else if (note === 'd5') {
        detune = 200;
        nt = c5;
      } else if (note === 'ds5') {
        detune = 300;
        nt = c5;
      } else if (note === 'e5') {
        detune = 400;
        nt = c5;
      } else if (note === 'f5') {
        detune = 500;
        nt = c5;
      } else if (note === 'fs5') {
        detune = 600;
        nt = c5;
      } else if (note === 'g5') {
        detune = 700;
        nt = c5;
      } else if (note === 'gs5') {
        detune = 800;
        nt = c5;
      } else if (note === 'a6') {
        detune = 900;
        nt = c5;
      } else if (note === 'as6') {
        detune = 1000;
        nt = c5;
      } else if (note === 'b6') {
        detune = 1100;
        nt = c5;
      } else if (note === 'c4') {
        detune = 0;
        nt = c4;
      } else if (note === 'cs4') {
        detune = 100;
        nt = c4;
      } else if (note === 'd4') {
        detune = 200;
        nt = c4;
      } else if (note === 'ds4') {
        detune = 300;
        nt = c4;
      } else if (note === 'e4') {
        detune = 400;
        nt = c4;
      } else if (note === 'f4') {
        detune = 500;
        nt = c4;
      } else if (note === 'fs4') {
        detune = 600;
        nt = c4;
      } else if (note === 'g4') {
        detune = 700;
        nt = c4;
      } else if (note === 'gs4') {
        detune = 800;
        nt = c4;
      } else if (note === 'a5') {
        detune = 900;
        nt = c4;
      } else if (note === 'as5') {
        detune = 1000;
        nt = c4;
      } else if (note === 'b5') {
        detune = 1100;
        nt = c4;
      } else if (note === 'c3') {
        detune = 0;
        nt = c3;
      } else if (note === 'cs3') {
        detune = 100;
        nt = c3;
      } else if (note === 'd3') {
        detune = 200;
        nt = c3;
      } else if (note === 'ds3') {
        detune = 300;
        nt = c3;
      } else if (note === 'e3') {
        detune = 400;
        nt = c3;
      } else if (note === 'f3') {
        detune = 500;
        nt = c3;
      } else if (note === 'fs3') {
        detune = 600;
        nt = c3;
      } else if (note === 'g3') {
        detune = 700;
        nt = c3;
      } else if (note === 'gs3') {
        detune = 800;
        nt = c3;
      } else if (note === 'a4') {
        detune = 900;
        nt = c3;
      } else if (note === 'as4') {
        detune = 1000;
        nt = c3;
      } else if (note === 'b4') {
        detune = 1100;
        nt = c3;

      } else if (note === 'c2') {
        detune = 0;
        nt = c2;
      } else if (note === 'cs2') {
        detune = 100;
        nt = c2;
      } else if (note === 'd2') {
        detune = 200;
        nt = c2;
      } else if (note === 'ds2') {
        detune = 300;
        nt = c2;
      } else if (note === 'e2') {
        detune = 400;
        nt = c2;
      } else if (note === 'f2') {
        detune = 500;
        nt = c2;
      } else if (note === 'fs2') {
        detune = 600;
        nt = c2;
      } else if (note === 'g2') {
        detune = 700;
        nt = c2;
      } else if (note === 'gs2') {
        detune = 800;
        nt = c2;
      } else if (note === 'a3') {
        detune = 900;
        nt = c2;
      } else if (note === 'as3') {
        detune = 1000;
        nt = c2;
      } else if (note === 'b3') {
        detune = 1100;
        nt = c2;
      } else {
      }

    //  source.connect(gainNode);
    //  gainNode.connect(audioCtx.destination);
//https://www.phpied.com/webaudio-deep-note-part-5-gain-node/ check this website ..getting noice, trying to get rid of noise buy using gain node
      playSound[counter].buffer = nt;
      var gainNode = ctx.createGain();
      var convolver = ctx.createConvolver();
      //console.log(nt)
      gainNode.gain.value = 1;

      gainNode.gain.setValueAtTime(1, ctx.currentTime+delay);
      gainNode.gain.exponentialRampToValueAtTime(0.0005, ctx.currentTime + 1.25 + delay);

      //gainNode.gain.setValueAtTime(0, ctx.currentTime + delay + 1);
      //gainNode.gain.linearRampToValueAtTime(0, ctx.currentTime + delay + .75);
      if (detune>0){
        playSound[counter].detune.value = detune;
      //console.log(detune)
      }
      //console.log(gainNode)
      playSound[counter].connect(gainNode).connect(ctx.destination);

      playSound[counter].start(ctx.currentTime + delay);
      counter = counter + 1
      console.log(counter)


      if (playSound[50]) {
      endd = playSound[50];
      endd.addEventListener("ended", () => {
        document.querySelector("button").disabled = false;
      })

    }}

    

    function step51 () {
      var del = 0
      start = 12
      for (let i = 0; i < 42 ; i++) {
        //console.log(i)
        playnote (keys[start+0],del + 0);
        playnote (keys[start+2],del + .5);
        playnote (keys[start+4],del + 1);
        playnote (keys[start+5],del + 1.5);
        playnote (keys[start+7],del + 2);
        playnote (keys[start+5],del + 2.5);
        playnote (keys[start+4],del + 3);
        playnote (keys[start+2],del + 3.5);
        playnote (keys[start+0],del + 4);
        if (i < 18) {
          playnote (keys[start+0],del + 5);
          playnote (keys[start+4],del + 5);
          playnote (keys[start+7],del + 5);
          playnote (keys[start+1+0],del + 5.5);
          playnote (keys[start+1+4],del + 5.5);
          playnote (keys[start+1+7],del + 5.5);
          start = start + 1
        } else {
          playnote (keys[start+0],del + 5);
          playnote (keys[start+4],del + 5);
          playnote (keys[start+7],del + 5);
          playnote (keys[start-1+0],del + 5.5);
          playnote (keys[start-1+4],del + 5.5);
          playnote (keys[start-1+7],del + 5.5);
          start = start - 1
        }
        del = del + 6.5
      }
    }
      function step52 () {
        var del = 0
        start = 12
        for (let i = 0; i < 42 ; i++) {
          //console.log(i)
          playnote (keys[start+0],del + 0);
          playnote (keys[start+2],del + .25);
          playnote (keys[start+4],del + .5);
          playnote (keys[start+5],del + .75);
          playnote (keys[start+7],del + 1);
          playnote (keys[start+5],del + 1.25);
          playnote (keys[start+4],del + 1.5);
          playnote (keys[start+2],del + 1.75);
          playnote (keys[start+0],del + 2);
          if (i < 18) {
            playnote (keys[start+0],del + 2.5);
            playnote (keys[start+4],del + 2.5);
            playnote (keys[start+7],del + 2.5);
            playnote (keys[start+1+0],del + 2.75);
            playnote (keys[start+1+4],del + 2.75);
            playnote (keys[start+1+7],del + 2.75);
            start = start + 1
          } else {
            playnote (keys[start+0],del + 2.5);
            playnote (keys[start+4],del + 2.5);
            playnote (keys[start+7],del + 2.5);
            playnote (keys[start-1+0],del + 2.75);
            playnote (keys[start-1+4],del + 2.75);
            playnote (keys[start-1+7],del + 2.75);
            start = start - 1
          }
          del = del + 3.75
        }
    }

    function step53 () {
      var del = 0
      start = 12
      for (let i = 0; i < 35 ; i++) {
       // console.log(i)
        playnote (keys[start+0],del + 0);
        playnote (keys[start+4],del + .25);
        playnote (keys[start+7],del + .5);
        playnote (keys[start+12],del + .75);
        playnote (keys[start+7],del + 1);
        playnote (keys[start+4],del + 1.25);
        playnote (keys[start+0],del + 1.5);
        if (i < 11) {
          playnote (keys[start+0],del + 2);
          playnote (keys[start+4],del + 2);
          playnote (keys[start+7],del + 2);
          playnote (keys[start+1+0],del + 2.25);
          playnote (keys[start+1+4],del + 2.25);
          playnote (keys[start+1+7],del + 2.25);
          start = start + 1
        } else {
          playnote (keys[start+0],del + 2);
          playnote (keys[start+4],del + 2);
          playnote (keys[start+7],del + 2);
          playnote (keys[start-1+0],del + 2.25);
          playnote (keys[start-1+4],del + 2.25);
          playnote (keys[start-1+7],del + 2.25);
          start = start - 1
        }
        del = del + 3
      }
  }

  function rocket () {
    var del = 0
    start = 12
    for (let i = 0; i < 42 ; i++) {
      //console.log(i)
      playnote (keys[start+0],del + 0);
      playnote (keys[start+0],del + .25);
      playnote (keys[start+4],del + .5);
      playnote (keys[start+4],del + .75);
      playnote (keys[start+7],del + 1);
      playnote (keys[start+7],del + 1.25);
      if (i < 18) {
        playnote (keys[start+0],del + 2);
        playnote (keys[start+4],del + 2);
        playnote (keys[start+7],del + 2);
        playnote (keys[start+1+0],del + 2.25);
        playnote (keys[start+1+4],del + 2.25);
        playnote (keys[start+1+7],del + 2.25);
        start = start + 1
      } else {
        playnote (keys[start+0],del + 2);
        playnote (keys[start+4],del + 2);
        playnote (keys[start+7],del + 2);
        playnote (keys[start-1+0],del + 2.25);
        playnote (keys[start-1+4],del + 2.25);
        playnote (keys[start-1+7],del + 2.25);
        start = start - 1
      }
      del = del + 3
    }
}


    //document.querySelector('button');


    btn.addEventListener('click', function() {
        
  //     document.addEventListener("DOMContentLoaded", function(event) {
  //     a = document.querySelector("button").disabled = true;
         document.querySelector("button").disabled = true;
   //    console.log(a.getAttribute("disabled"));
   //    });
// Disable the button

   


    male_keys = ['c2','cs2','d2','ds2','e2','f2','fs2','g2', 'gs2','a3','as3','b3', 'c3', 'cs3', 'd3', 'ds3', 'e3', 'f3', 'fs3', 'g3', 'gs3', 'a4', 'as4', 'b4', 'c4', 'cs4','d4', 'ds4', 'e4', 'f4', 'fs4', 'g4', 'gs4', 'a5', 'as5', 'b5', 'c5', 'cs5', 'd5', 'ds5', 'e5', 'f5', 'fs5', 'gs5', 'a6', 'as6', 'b6']
    female_keys = ['c3', 'cs3', 'd3', 'ds3', 'e3', 'f3', 'fs3', 'g3', 'gs3', 'a4', 'as4', 'b4', 'c4', 'cs4','d4', 'ds4', 'e4', 'f4', 'fs4', 'g4', 'gs4', 'a5', 'as5', 'b5', 'c5', 'cs5', 'd5', 'ds5', 'e5', 'f5', 'fs5','g5', 'gs5', 'a6', 'as6', 'b6']

    var vr = document.getElementById("vocal_range");
      var vocal_range = vr.value;
      console.log(vocal_range)
      if (vocal_range === 'male') {
        keys = male_keys;
      }
      else if (vocal_range === 'female') {
        keys = female_keys;
      }

     // ctx.resume()
      if (ctx.state === "suspended") {
      ctx.resume();
      }
      var e = document.getElementById("lesson_select");
      var lesson_sel = e.value;
      console.log(lesson_sel)

      counter = 0;


   

      if (lesson_sel === 'step51') {
        step51();
      }

      else if (lesson_sel === 'step52') {
        step52();
      }

      else if (lesson_sel === 'step53') {
        step53();
      }

      else if (lesson_sel === 'rocket') {
        rocket();
      }


    });



    btn_stop.addEventListener('click', function() {
        for (let i = 0; i < 1000 ; i++) {
        a = playSound[i]
  
        if (a) {
          a.stop()
       }
    

      console.log(i)
  
      }



      counter = 0;
      document.querySelector("button").disabled = false;
    });

   
/////////////////////////////////////////////////Web audio
// https://chrislowis.co.uk/2013/06/05/playing-notes-web-audio-api.html
//https://codepen.io/noogn/pen/NWNrKe
//https://www.thecodecreative.com/blog/how-to-load-an-audio-file-using-fetch



</script>

</html>
